"use strict";(()=>{var o=class extends HTMLElement{constructor(){super();this.state="";this.config={actions:{},initialState:"",listeners:[],states:{}};this.subs=[];this.timeouts={};this.handleEvent=this.handleEvent.bind(this),this.applyAction=this.applyAction.bind(this),this.applyAppend=this.applyAppend.bind(this),this.applyAttr=this.applyAttr.bind(this),this.applyCall=this.applyCall.bind(this),this.applyEventListener=this.applyEventListener.bind(this),this.applyDispatch=this.applyDispatch.bind(this),this.applyGet=this.applyGet.bind(this),this.applyWin=this.applyWin.bind(this),this.applyPost=this.applyPost.bind(this),this.applyReplace=this.applyReplace.bind(this),this.applyState=this.applyState.bind(this),this.applyText=this.applyText.bind(this),this.applyWait=this.applyWait.bind(this),this.dispatch=this.dispatch.bind(this),this.handleClientEvent=this.handleClientEvent.bind(this),this.handleServerEvent=this.handleServerEvent.bind(this),this.init=this.init.bind(this),this.sub=this.sub.bind(this),this.transform=this.transform.bind(this)}applyAction(t){let[,e]=t;this.config.actions[e].forEach(s=>this.handleEvent(e,[s]))}applyAppend(t){let[,e,s]=t,i=this.querySelector(e);if(!i)return;let n=document.createElement("template");n.innerHTML=decodeURIComponent(s),i.append(n.content)}applyAttr(t){let[,e,s,i]=t;this.querySelectorAll(e).forEach(a=>{if(i===null)return a.removeAttribute(s);a.setAttribute(s,i)})}applyCall(t){let[,e,s,...i]=t,n=this.querySelector(e);!n||n[s](...i)}applyEventListener(t){let[e,s,i]=t,n=this.querySelectorAll(s);for(let a=0;a<n.length;a++){let r=n[a],l=p=>{p.preventDefault(),this.handleClientEvent(i)};r.removeEventListener(e,l),r.addEventListener(e,l)}}applyDispatch(t){let[,e,s=0]=t;clearTimeout(this.timeouts[e]),this.timeouts[e]=setTimeout(()=>this.handleClientEvent(e),s)}applyGet(t){let[,e]=t;fetch(e,{method:"GET"}).then(s=>s.json().then(i=>this.handleEvent("entry",i)))}applyWin(t){let[,e,...s]=t;window[e](...s)}applyPost(t){let[,e,...s]=t,i={};for(let n=0;n<s.length;n++){let[a,r,l]=s[n],p=this.querySelector(r);if(!p)return;i[a]=p[l]}fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(n=>n.json().then(a=>this.handleEvent("entry",a)))}applyReplace(t){let[,e,s]=t,i=this.querySelector(e);if(!i)return;let n=i.parentElement;if(!n)return;let a=document.createElement("template");a.innerHTML=decodeURIComponent(s),n.replaceChild(a.content,i)}applyState(t){let[,e]=t;this.config.states[e].entry&&this.handleEvent("entry",this.config.states[e].entry),this.state=e}applyText(t){let[,e,s]=t;this.querySelectorAll(e).forEach(n=>n.textContent=s)}applyWait(t){let[,e,s]=t,i=new Date().getTime();for(;new Date().getTime()-i<e;);s&&this.handleClientEvent(s)}connectedCallback(){let t=this.getAttribute("src");!t||fetch(t).then(e=>e.json().then(this.init))}dispatch(t){this.handleClientEvent(t)}handleClientEvent(t){this.handleEvent(t,this.config.states[this.state][t])}handleServerEvent(t){let{evt:e}=t,s=this.config.states[this.state][e].reduce((i,n)=>[...i,n],[]);this.handleEvent(e,s)}handleEvent(t,e){if(!!e)for(let s=0;s<e.length;s++){let i=e[s],[n]=i;({action:this.applyAction,append:this.applyAppend,attr:this.applyAttr,call:this.applyCall,click:this.applyEventListener,dispatch:this.applyDispatch,get:this.applyGet,post:this.applyPost,replace:this.applyReplace,state:this.applyState,submit:this.applyEventListener,text:this.applyText,wait:this.applyWait,win:this.applyWin})[n](i),this.subs.forEach(r=>r(this.state,t,i))}}init(t){this.config=t;let e=this,s=this.config.listeners??[],i=()=>{for(let r=0;r<s.length;r++){let[l,p,x]=s[r],c=this.querySelectorAll(l);for(let h=0;h<c.length;h++){let v=c[h],d=y=>{y.preventDefault(),y.target===v&&this.handleClientEvent(x)};e.removeEventListener(p,d),e.addEventListener(p,d)}}};new MutationObserver(r=>{r.forEach(l=>{l.type==="childList"&&l.addedNodes&&i()})}).observe(this,{attributes:!0,childList:!0,subtree:!0}),i();let a=t.states[t.initialState];this.state=t.initialState,a.entry&&this.handleEvent("entry",a.entry)}sub(t){this.subs.push(t)}transform(t,e){this.handleEvent(t,e)}};customElements.define("dx-state",o);})();
//# sourceMappingURL=dx-state.js.map
