"use strict";(()=>{var h=class extends HTMLElement{constructor(){super();this.subs=[];this.transform=this.transform.bind(this),this.applyAppend=this.applyAppend.bind(this),this.applyAttr=this.applyAttr.bind(this),this.applyCall=this.applyCall.bind(this),this.applyEventListener=this.applyEventListener.bind(this),this.applyDispatch=this.applyDispatch.bind(this),this.applyGet=this.applyGet.bind(this),this.applyJs=this.applyJs.bind(this),this.applyPost=this.applyPost.bind(this),this.applyReplace=this.applyReplace.bind(this),this.applyState=this.applyState.bind(this),this.applyText=this.applyText.bind(this),this.applyWait=this.applyWait.bind(this),this.dispatch=this.dispatch.bind(this),this.handleClientEvent=this.handleClientEvent.bind(this),this.handleServerEvent=this.handleServerEvent.bind(this),this.init=this.init.bind(this),this.sub=this.sub.bind(this)}connectedCallback(){let t=this.getAttribute("src");!t||fetch(t).then(e=>e.json().then(this.init))}applyAppend(t){let[,e,s]=t,i=this.querySelector(e);if(!i)return;let n=document.createElement("template");n.innerHTML=decodeURIComponent(s),i.append(n.content)}applyAttr(t){let[,e,s,i]=t;this.querySelectorAll(e).forEach(r=>{if(i===null)return r.removeAttribute(s);r.setAttribute(s,i)})}applyCall(t){let[,e,s,...i]=t,n=this.querySelector(e);!n||n[s](...i)}applyEventListener(t){let[e,s,i]=t;console.log(t);let n=this.querySelectorAll(s);for(let r=0;r<n.length;r++){let a=n[r],l=p=>{p.preventDefault(),this.handleClientEvent(i)};a.removeEventListener(e,l),a.addEventListener(e,l)}}applyDispatch(t){let[,e]=t;this.handleClientEvent(e)}applyGet(t){let[,e]=t;fetch(e,{method:"GET"}).then(s=>s.json().then(i=>this.transform("entry",i)))}applyJs(t){let[,e,...s]=t;window[e](...s)}applyPost(t){let[,e,...s]=t,i={};for(let n=0;n<s.length;n++){let[r,a,l]=s[n],p=this.querySelector(a);if(!p)return;i[r]=p[l]}fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(n=>n.json().then(r=>this.transform("entry",r)))}applyReplace(t){let[,e,s]=t,i=this.querySelector(e);if(!i)return;let n=i.parentElement;if(!n)return;let r=document.createElement("template");r.innerHTML=decodeURIComponent(s),n.replaceChild(r.content,i)}applyState(t){let[,e]=t;this.config.states[e].entry&&this.transform("entry",this.config.states[e].entry),this.state=e}applyText(t){let[,e,s]=t;this.querySelectorAll(e).forEach(n=>n.textContent=s)}applyWait(t){let[,e,s]=t,i=new Date().getTime();for(;new Date().getTime()-i<e;);s&&this.handleClientEvent(s)}dispatch(t){this.handleClientEvent(t)}handleClientEvent(t){this.transform(t,this.config.states[this.state][t])}handleServerEvent(t){let{action:e}=t,s=this.config.states[this.state][e].reduce((i,n)=>[...i,n],[]);this.transform(e,s)}init(t){this.config=t;let e=this,s=this.config.listeners??[];new MutationObserver(r=>{r.forEach(a=>{if(a.type==="childList"&&a.addedNodes.length>0)for(let l=0;l<s.length;l++){let[p,c,g]=s[l],d=this.querySelectorAll(p);for(let o=0;o<d.length;o++){let D=d[o],y=x=>{x.preventDefault(),x.target===D&&this.handleClientEvent(g)};e.removeEventListener(c,y),e.addEventListener(c,y)}}})}).observe(this,{attributes:!0,childList:!0,subtree:!0});let n=t.states[t.initialState];this.state=t.initialState,n.entry&&this.transform("entry",n.entry)}sub(t){this.subs.push(t)}transform(t,e){if(!!e)for(let s=0;s<e.length;s++){let i=e[s],[n]=i;({append:this.applyAppend,attr:this.applyAttr,click:this.applyEventListener,call:this.applyCall,dispatch:this.applyDispatch,js:this.applyJs,get:this.applyGet,post:this.applyPost,replace:this.applyReplace,state:this.applyState,submit:this.applyEventListener,text:this.applyText,wait:this.applyWait})[n](i),this.subs.forEach(a=>a(this.state,t,i))}}};customElements.define("dx-x",h);})();
//# sourceMappingURL=dx.js.map
