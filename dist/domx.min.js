"use strict";(()=>{async function h(s,t,e){document.querySelectorAll(t).forEach(n=>n.classList.add(e))}async function p(s,t,e,r){document.querySelectorAll(t).forEach(o=>{let a=i=>{i.preventDefault(),i.target===o&&s.dispatch(r)};o.removeEventListener(e,a),o.addEventListener(e,a)})}async function g(s,t,e){let r=document.querySelector(t);if(!r)return;let n=document.createElement("template");n.innerHTML=decodeURIComponent(e),r.append(n.content)}async function T(s,t,e=0){clearTimeout(s.timeouts[t]),s.timeouts[t]=setTimeout(()=>s.dispatch(t),e)}async function y(s,t,e,r){window.history.pushState(t,e,r)}async function v(s,t,...e){let r=new URLSearchParams;e.forEach(([o,a,i,c])=>{switch(i){case"attribute":let m=document.querySelector(a);if(!m)return;r.append(o,m.getAttribute(c));break;case"dataset":let d=document.querySelector(a);if(!d)return;r.append(o,d.dataset[i][c]);break;case"value":let l=document.querySelector(a);if(!l)return;r.append(o,l.value);break}});let n=t+"?"+r.toString();fetch(n,{method:"GET",headers:{domx:s.getHeaderData()}}).then(o=>o.json().then(a=>s.transform(a)))}async function L(s,t,e){let r=document.querySelector(t);!r||(r.innerHTML=decodeURIComponent(e))}async function b(s,t){window.location.href=t}async function x(s,t,...e){let r=new FormData;e.forEach(([n,o,a,i])=>{switch(a){case"attribute":let c=document.querySelector(o);if(!c)return;r.append(n,c.getAttribute(i));break;case"dataset":let m=document.querySelector(o);if(!m)return;r.append(n,m.dataset[a][i]);break;case"value":let d=document.querySelector(o);if(!d)return;r.append(n,d.value);break}}),fetch(t,{body:r,method:"POST",headers:{domx:s.getHeaderData()}}).then(n=>n.json().then(o=>s.transform(o)))}async function S(s,t,e){let r=document.querySelector(t);!r||(r.textContent=decodeURIComponent(e))}async function E(s,t,e){document.querySelectorAll(t).forEach(n=>n.removeAttribute(e))}async function A(s,t,e,r){document.querySelectorAll(t).forEach(o=>{let a=i=>{i.preventDefault(),i.target===o&&s.dispatch(r)};o.removeEventListener(e,a)})}async function w(s,t,e){document.querySelectorAll(t).forEach(n=>n.classList.remove(e))}async function D(s,t,e){let r=document.querySelector(t);if(!r)return;let n=document.createElement("template");n.innerHTML=decodeURIComponent(e),r.replaceWith(n.content)}async function M(s,t,e,r){document.querySelectorAll(t).forEach(o=>{if(r===null)return o.removeAttribute(e);o.setAttribute(e,r)})}async function q(s,t){s.state=t,s.fsm.states[t].entry&&s.dispatch("entry")}async function R(s,t){let e=document.querySelector(t),r=(e.method??"POST").toUpperCase(),n=e.enctype??"application/x-www-form-urlencoded",o=new FormData(e);fetch(e.action,{body:o,method:r,headers:{domx:s.getHeaderData(),contentType:n}}).then(a=>a.json().then(i=>s.transform(i)))}async function H(s,t){return new Promise(e=>setTimeout(e,t))}async function C(s,t,...e){window[t](...e)}var f=class{constructor(t){this.fsm={id:"",initialState:"",listeners:[],states:{}};this.state="";this.subs=[];this.timeouts={};this.tranformers={};this.unsub=t=>{this.subs=this.subs.filter(e=>e!==t)};this.dispatch=this.dispatch.bind(this),this.init=this.init.bind(this),this.registerEventListeners=this.registerEventListeners.bind(this),this.sub=this.sub.bind(this),this.transform=this.transform.bind(this),this.addTransformer("addClass",h),this.addTransformer("addEventListener",p),this.addTransformer("append",g),this.addTransformer("dispatch",T),this.addTransformer("innerHTML",L),this.addTransformer("history",y),this.addTransformer("get",v),this.addTransformer("location",b),this.addTransformer("post",x),this.addTransformer("removeAttribute",E),this.addTransformer("removeClass",w),this.addTransformer("removeEventListener",A),this.addTransformer("replace",D),this.addTransformer("setAttribute",M),this.addTransformer("state",q),this.addTransformer("submit",R),this.addTransformer("textContent",S),this.addTransformer("wait",H),this.addTransformer("window",C),t&&document.addEventListener("DOMContentLoaded",()=>this.init(t))}addTransformer(t,e){return this.tranformers[t]=e,this}dispatch(t){let e=this.fsm.states[this.state][t];if(!e)return;let r=this.state;this.transform(e,()=>{this.subs.forEach(n=>n(t,r,this.state))})}getHeaderData(){return JSON.stringify({id:this.fsm.id,state:this.state})}init(t){this.fsm=t,this.registerEventListeners();let e=t.states[t.initialState];this.state=t.initialState,e.entry&&this.dispatch("entry")}registerEventListeners(){let t=this.fsm.listeners??[];for(let e=0;e<t.length;e++){let[r,n,o]=t[e],a=document.querySelectorAll(r);for(let i=0;i<a.length;i++){let c=a[i],m=d=>{d.preventDefault(),d.target===c&&this.dispatch(o)};c.removeEventListener(n,m),c.addEventListener(n,m)}}}sub(t){return this.subs.push(t),()=>this.unsub(t)}async transform(t=[],e){if(!!t){for(let r=0;r<t.length;r++){let n=t[r],[o,...a]=n,i=this.tranformers[o];if(!i)throw new Error(`Unknown transformer: ${o}`);await i(this,...a)}e&&e()}}},u=class extends HTMLElement{constructor(){super();this.instance=new f;this.registerLocalFSM=this.registerLocalFSM.bind(this),this.registerRemoteFSM=this.registerRemoteFSM.bind(this);let e=document.createElement("slot");e.style.display="none",this.attachShadow({mode:"open"}).appendChild(e),e.addEventListener("slotchange",()=>this.registerLocalFSM(e))}connectedCallback(){this.getAttribute("src")&&this.registerRemoteFSM()}registerLocalFSM(e){let n=e.assignedNodes()[0].nodeValue;if(n)return this.instance.init(JSON.parse(n))}registerRemoteFSM(){let e=this.getAttribute("src");if(e)return fetch(e).then(r=>r.json().then(this.instance.init))}};customElements.define("dom-x",u);window.Domx=f;})();
//# sourceMappingURL=domx.min.js.map
