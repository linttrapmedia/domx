"use strict";(()=>{function l(r,t,e){document.querySelectorAll(t).forEach(n=>n.classList.add(e))}function u(r,t,e,s){document.querySelectorAll(t).forEach(i=>{let a=o=>{o.preventDefault(),o.target===i&&r.dispatch(s)};i.removeEventListener(e,a),i.addEventListener(e,a)})}function g(r,t,e){let s=document.querySelector(t);if(!s)return;let n=document.createElement("template");n.innerHTML=decodeURIComponent(e),s.append(n.content)}function T(r,t,e=0){clearTimeout(r.timeouts[t]),r.timeouts[t]=setTimeout(()=>r.dispatch(t),e)}function p(r,t,e,s){window.history.pushState(t,e,s)}function L(r,t){fetch(t,{method:"GET"}).then(e=>e.json().then(s=>r.transform(s)))}function v(r,t,e){let s=document.querySelector(t);!s||(s.innerHTML=decodeURIComponent(e))}function E(r,t){window.location.href=t}function S(r,t){let e=document.querySelector(t),s=new FormData(e);fetch(e.action,{body:s,method:"POST"}).then(n=>n.json().then(i=>r.transform(i)))}function y(r,t,e){let s=document.querySelector(t);!s||(s.textContent=decodeURIComponent(e))}function b(r,t,e){document.querySelectorAll(t).forEach(n=>n.removeAttribute(e))}function M(r,t,e,s){document.querySelectorAll(t).forEach(i=>{let a=o=>{o.preventDefault(),o.target===i&&r.dispatch(s)};i.removeEventListener(e,a)})}function w(r,t,e){document.querySelectorAll(t).forEach(n=>n.classList.remove(e))}function D(r,t,e){let s=document.querySelector(t);if(!s)return;let n=document.createElement("template");n.innerHTML=decodeURIComponent(e),s.replaceWith(n.content)}function x(r,t,e,s){document.querySelectorAll(t).forEach(i=>{if(s===null)return i.removeAttribute(e);i.setAttribute(e,s)})}function A(r,t){let e=new Date().getTime();for(;new Date().getTime()-e<t;);}function C(r,t,...e){window[t](...e)}function H(r,t){r.state=t,r.fsm.states[t].entry&&r.dispatch("entry")}var c=class{constructor(t){this.state="";this.fsm={initialState:"",listeners:[],states:{}};this.subs=[];this.timeouts={};this.tranformers={};this.unsub=t=>{this.subs=this.subs.filter(e=>e!==t)};this.dispatch=this.dispatch.bind(this),this.init=this.init.bind(this),this.registerEventListeners=this.registerEventListeners.bind(this),this.sub=this.sub.bind(this),this.transform=this.transform.bind(this),this.addTransformer("addClass",l),this.addTransformer("addEventListener",u),this.addTransformer("append",g),this.addTransformer("dispatch",T),this.addTransformer("innerHTML",v),this.addTransformer("history",p),this.addTransformer("get",L),this.addTransformer("location",E),this.addTransformer("post",S),this.addTransformer("removeAttribute",b),this.addTransformer("removeClass",w),this.addTransformer("removeEventListener",M),this.addTransformer("replace",D),this.addTransformer("setAttribute",x),this.addTransformer("state",H),this.addTransformer("textContent",y),this.addTransformer("wait",A),this.addTransformer("window",C),t&&document.addEventListener("DOMContentLoaded",()=>this.init(t))}addTransformer(t,e){return this.tranformers[t]=e,this}dispatch(t){let e=this.fsm.states[this.state][t];if(!e)return;let s=this.state;this.transform(e,()=>{this.subs.forEach(n=>n(t,s,this.state))})}init(t){this.fsm=t,this.registerEventListeners();let e=t.states[t.initialState];this.state=t.initialState,e.entry&&this.dispatch("entry")}registerEventListeners(){let t=this.fsm.listeners??[];for(let e=0;e<t.length;e++){let[s,n,i]=t[e],a=document.querySelectorAll(s);for(let o=0;o<a.length;o++){let d=a[o],f=h=>{h.preventDefault(),h.target===d&&this.dispatch(i)};d.removeEventListener(n,f),d.addEventListener(n,f)}}}sub(t){return this.subs.push(t),()=>this.unsub(t)}transform(t=[],e){if(!!t){for(let s=0;s<t.length;s++){let n=t[s],[i,...a]=n,o=this.tranformers[i];if(!o)throw new Error(`Unknown transformer: ${i}`);o(this,...a)}e&&e()}}},m=class extends HTMLElement{constructor(){super();this.instance=new c;this.registerLocalFSM=this.registerLocalFSM.bind(this),this.registerRemoteFSM=this.registerRemoteFSM.bind(this);let e=document.createElement("slot");e.style.display="none",this.attachShadow({mode:"open"}).appendChild(e),e.addEventListener("slotchange",()=>this.registerLocalFSM(e))}connectedCallback(){this.getAttribute("src")&&this.registerRemoteFSM()}registerLocalFSM(e){let n=e.assignedNodes()[0].nodeValue;if(n)return this.instance.init(JSON.parse(n))}registerRemoteFSM(){let e=this.getAttribute("src");if(e)return fetch(e).then(s=>s.json().then(this.instance.init))}};customElements.define("dom-x",m);window.Domx=c;})();
//# sourceMappingURL=domx.min.js.map
