"use strict";(()=>{function h(s,t,e){document.querySelectorAll(t).forEach(n=>n.classList.add(e))}function u(s,t,e,r){document.querySelectorAll(t).forEach(o=>{let a=i=>{i.preventDefault(),i.target===o&&s.dispatch(r)};o.removeEventListener(e,a),o.addEventListener(e,a)})}function T(s,t,e){let r=document.querySelector(t);if(!r)return;let n=document.createElement("template");n.innerHTML=decodeURIComponent(e),r.append(n.content)}function g(s,t,e=0){clearTimeout(s.timeouts[t]),s.timeouts[t]=setTimeout(()=>s.dispatch(t),e)}function p(s,t,e,r){window.history.pushState(t,e,r)}function y(s,t){fetch(t,{method:"GET"}).then(e=>e.json().then(r=>s.transform(r)))}function L(s,t,e){let r=document.querySelector(t);!r||(r.innerHTML=decodeURIComponent(e))}function v(s,t){window.location.href=t}function x(s,t){let e=document.querySelector(t),r=new FormData(e);fetch(e.action,{body:r,method:"POST"}).then(n=>n.json().then(o=>s.transform(o)))}function E(s,t,e){let r=document.querySelector(t);!r||(r.textContent=decodeURIComponent(e))}function A(s,t,e){document.querySelectorAll(t).forEach(n=>n.removeAttribute(e))}function S(s,t,e,r){document.querySelectorAll(t).forEach(o=>{let a=i=>{i.preventDefault(),i.target===o&&s.dispatch(r)};o.removeEventListener(e,a)})}function b(s,t,e){document.querySelectorAll(t).forEach(n=>n.classList.remove(e))}function w(s,t,e){let r=document.querySelector(t);if(!r)return;let n=document.createElement("template");n.innerHTML=decodeURIComponent(e),r.replaceWith(n.content)}function M(s,t,e,r){document.querySelectorAll(t).forEach(o=>{if(r===null)return o.removeAttribute(e);o.setAttribute(e,r)})}function D(s,t){let e=new Date().getTime();for(;new Date().getTime()-e<t;);}function R(s,t,...e){window[t](...e)}function C(s,t){s.state=t,s.fsm.states[t].entry&&s.dispatch("entry")}var m=class{constructor(t){this.state="";this.fsm={initialState:"",listeners:[],states:{}};this.subs=[];this.timeouts={};this.tranformers={};this.unsub=t=>{this.subs=this.subs.filter(e=>e!==t)};this.dispatch=this.dispatch.bind(this),this.init=this.init.bind(this),this.registerEventListeners=this.registerEventListeners.bind(this),this.sub=this.sub.bind(this),this.transform=this.transform.bind(this),this.addTransformer("addClass",h),this.addTransformer("addEventListener",u),this.addTransformer("append",T),this.addTransformer("dispatch",g),this.addTransformer("innerHTML",L),this.addTransformer("history",p),this.addTransformer("get",y),this.addTransformer("location",v),this.addTransformer("post",x),this.addTransformer("removeAttribute",A),this.addTransformer("removeClass",b),this.addTransformer("removeEventListener",S),this.addTransformer("replace",w),this.addTransformer("setAttribute",M),this.addTransformer("state",C),this.addTransformer("textContent",E),this.addTransformer("wait",D),this.addTransformer("window",R),t&&document.addEventListener("DOMContentLoaded",()=>this.init(t))}addTransformer(t,e){return this.tranformers[t]=e,this}dispatch(t){let e=this.fsm.states[this.state][t];if(!e)return;let r=this.state;this.transform(e,()=>{this.subs.forEach(n=>n(t,r,this.state))})}init(t){this.fsm=t,this.registerEventListeners();let e=t.states[t.initialState];this.state=t.initialState,e.entry&&this.dispatch("entry")}registerEventListeners(){let t=this.fsm.listeners??[];for(let e=0;e<t.length;e++){let[r,n,o]=t[e],a=document.querySelectorAll(r);for(let i=0;i<a.length;i++){let d=a[i],c=l=>{l.preventDefault(),l.target===d&&this.dispatch(o)};d.removeEventListener(n,c),d.addEventListener(n,c)}}}sub(t){return this.subs.push(t),()=>this.unsub(t)}transform(t=[],e){if(!!t){for(let r=0;r<t.length;r++){let n=t[r],[o,...a]=n,i=this.tranformers[o];if(!i)throw new Error(`Unknown transformer: ${o}`);i(this,...a)}e&&e()}}},f=class extends HTMLElement{constructor(){super();this.instance=new m;this.registerLocalFSM=this.registerLocalFSM.bind(this),this.registerRemoteFSM=this.registerRemoteFSM.bind(this);let e=document.createElement("slot");e.style.display="none",this.attachShadow({mode:"open"}).appendChild(e),e.addEventListener("slotchange",()=>this.registerLocalFSM(e))}connectedCallback(){this.getAttribute("src")&&this.registerRemoteFSM()}registerLocalFSM(e){let n=e.assignedNodes()[0].nodeValue;if(n)return this.instance.init(JSON.parse(n))}registerRemoteFSM(){let e=this.getAttribute("src");if(e)return fetch(e).then(r=>r.json().then(this.instance.init))}};customElements.define("dom-x",f);window.Domx=m;})();
//# sourceMappingURL=domx.min.js.map
