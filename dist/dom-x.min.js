"use strict";(()=>{function T(n,t,e){document.querySelectorAll(t).forEach(s=>s.classList.add(e))}function p(n,t,e,r){document.querySelectorAll(t).forEach(i=>{let a=o=>{o.preventDefault(),o.target===i&&n.dispatch(r)};i.removeEventListener(e,a),i.addEventListener(e,a)})}function v(n,t,e){let r=document.querySelector(t);if(!r)return;let s=document.createElement("template");s.innerHTML=decodeURIComponent(e),r.append(s.content)}function b(n,t,e=0){clearTimeout(n.timeouts[t]),n.timeouts[t]=setTimeout(()=>n.dispatch(t),e)}function L(n,t,e,r){window.history.pushState(t,e,r)}function y(n,t){fetch(t,{method:"GET"}).then(e=>e.json().then(r=>n.transform(r)))}function E(n,t,e){let r=document.querySelector(t);r&&(r.innerHTML=decodeURIComponent(e))}function S(n,t){window.location.href=t}function D(n,t){let e=document.querySelector(t),r=new FormData(e);fetch(e.action,{body:r,method:"POST"}).then(s=>s.json().then(i=>n.transform(i)))}function w(n,t,e){let r=document.querySelector(t);r&&(r.textContent=decodeURIComponent(e))}function x(n,t,e){document.querySelectorAll(t).forEach(s=>s.removeAttribute(e))}function M(n,t,e,r){document.querySelectorAll(t).forEach(i=>{let a=o=>{o.preventDefault(),o.target===i&&n.dispatch(r)};i.removeEventListener(e,a)})}function A(n,t,e){document.querySelectorAll(t).forEach(s=>s.classList.remove(e))}function q(n,t,e){let r=document.querySelector(t);if(!r)return;let s=document.createElement("template");s.innerHTML=decodeURIComponent(e),r.replaceWith(s.content)}function H(n,t,e,r){document.querySelectorAll(t).forEach(i=>{if(r===null)return i.removeAttribute(e);i.setAttribute(e,r)})}function C(n,t){let e=new Date().getTime();for(;new Date().getTime()-e<t;);}function _(n,t,...e){window[t](...e)}function R(n,t){n.state=t,n.fsm.states[t].entry&&n.dispatch("entry")}var d=class extends HTMLElement{state="";fsm={initialState:"",listeners:[],states:{}};subs=[];timeouts={};tranformers={};addTransformer(t,e){return this.tranformers[t]=e,this}constructor(){super(),this.dispatch=this.dispatch.bind(this),this.init=this.init.bind(this),this.sub=this.sub.bind(this),this.transform=this.transform.bind(this),this.addTransformer("addClass",T),this.addTransformer("addEventListener",p),this.addTransformer("append",v),this.addTransformer("dispatch",b),this.addTransformer("innerHTML",E),this.addTransformer("history",L),this.addTransformer("get",y),this.addTransformer("location",S),this.addTransformer("post",D),this.addTransformer("removeAttribute",x),this.addTransformer("removeClass",A),this.addTransformer("removeEventListener",M),this.addTransformer("replace",q),this.addTransformer("setAttribute",H),this.addTransformer("state",R),this.addTransformer("textContent",w),this.addTransformer("wait",C),this.addTransformer("window",_)}connectedCallback(){let t=this.getAttribute("src");if(t)return fetch(t).then(r=>r.json().then(this.init));let e=this.getAttribute("obj");if(e)return this.init(window[e])}dispatch(t){let e=this.fsm.states[this.state][t];if(!e)return;let r=this.state;this.transform(e,()=>{this.subs.forEach(s=>s(t,r,this.state))})}init(t){this.fsm=t;let e=this.fsm.listeners??[],r=()=>{for(let a=0;a<e.length;a++){let[o,f,g]=e[a],u=document.querySelectorAll(o);for(let c=0;c<u.length;c++){let m=u[c],h=l=>{l.preventDefault(),l.target===m&&this.dispatch(g)};m.removeEventListener(f,h),m.addEventListener(f,h)}}};new MutationObserver(a=>{a.forEach(o=>{o.type==="childList"&&o.addedNodes&&r()})}).observe(this,{attributes:!0,childList:!0,subtree:!0}),r();let i=t.states[t.initialState];this.state=t.initialState,i.entry&&this.dispatch("entry")}sub(t){return this.subs.push(t),()=>this.unsub(t)}transform(t=[],e){if(t){for(let r=0;r<t.length;r++){let s=t[r],[i,...a]=s,o=this.tranformers[i];if(!o)throw new Error(`Unknown transformer: ${i}`);o(this,...a)}e&&e()}}unsub=t=>{this.subs=this.subs.filter(e=>e!==t)}};customElements.define("dom-x",d);})();
//# sourceMappingURL=dom-x.min.js.map
